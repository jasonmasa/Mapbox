<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Reval Neighbourhood Map</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
        .marker {
          background-image: url('geophy-map-marker.png');
          background-size: cover;
          width: 32px;
          height: 45px;
}
    </style>
</head>

<body>

<div id='map'></div>
<script>
mapboxgl.accessToken = 'pk.eyJ1Ijoiai1nZW8iLCJhIjoiY2p0enJ3aXBqMGRoZDQ1cDlhcnN3NDJtcCJ9.xI9LbuSbStySy4LBwU58mQ';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/j-geo/cju2cghyb18t01fpedzr4mcib',
    center: [-84.496903, 38.046924],
    zoom: 16,
    minZoom: 13
});

    //Adds a map zoom button
map.addControl(new mapboxgl.NavigationControl());

    //When the map is loaded the following actions occur:
map.on('load', function () {

    var layers = map.getStyle().layers;
    // Finds the index of the first symbol layer in the map so we can work with layer ordering
    var firstSymbolId;
    for (var i = 0; i < layers.length; i++) {
        if (layers[i].type === 'symbol') {
            firstSymbolId = layers[i].id;
            break;
        }
    }


    var mapMarker = {
      type: 'FeatureCollection',
      features: [{
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: [-84.496903, 38.046924]
        },
        properties: {
          title: 'Map marker',
          description: 'Property name'
        }
      }]
    };



    // Adds a map pin to the location of the property input by the user
    mapMarker.features.forEach(function(marker) {

    // create a HTML element for each feature
  var el = document.createElement('div');
  el.className = 'marker';

  // make a marker for each feature and add to the map
  new mapboxgl.Marker(el, {anchor: 'bottom'})
    .setLngLat(marker.geometry.coordinates)
    .addTo(map);
});


map.addLayer({
    'id': 'restaurants-base',
    'type': 'circle',
    'source': {
        type: 'geojson',
        data: 'https://raw.githubusercontent.com/jasonmasa/geojson/master/restaurant.geojson'
      },
    'paint': {
        // make circles larger as the user zooms from z12 to z22
        'circle-radius': {
            'base': 10,
            'stops': [[10, 2], [16, 13], [18, 21]]
        },
        'circle-color': [
'match',
['get', 'REACH'],
'5min Walk', '#fbb03b',
'15min Walk', '#fbb03b',
'15min Drive', '#fbb03b',
'30min Drive', '#fbb03b',
/* other */ '#ccc'
],
        'circle-opacity': 0.25
    }
}, firstSymbolId);


map.addLayer({
    'id': 'restaurants',
    'type': 'circle',
    'source': {
        type: 'geojson',
        data: 'https://raw.githubusercontent.com/jasonmasa/geojson/master/restaurant.geojson'
      },
    'paint': {
        // make circles larger as the user zooms from z12 to z22
        'circle-radius': {
            'base': 3,
            'stops': [[12, 3], [22, 8]]
        },
        'circle-stroke-width': 1,
        'circle-stroke-color': '#fff',
        'circle-color': '#cc7e00'
    }
}, firstSymbolId);

});
</script>


</body>
</html>
